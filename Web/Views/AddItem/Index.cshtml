@using Web.Models;
@using BloodSearch.Models.Api.Models.Offers;

@model AddItemRequest

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>Подача объявления — BloodSearch.com</title>
    <link rel="stylesheet" href="/content/css/styles.css" type="text/css" media="screen, projection" />
    <script src="~/Scripts/jquery-3.2.1.min.js"></script>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;load=package.full"></script>
</head>
<body>

    @Html.Partial("_Header", 0)

    <main>
        <div class="wrap">
            <div class="frame shadow form-additem">

                <h1>Разместить объявление</h1>

                <form id="add-item-form" method="post">

                    <div class="form-additem__group">
                        <div class="form-additem__group-row">
                            <div class="form-additem__group-row__col">
                                <label for="name" class="">Имя:</label>
                            </div>
                            <div class="form-additem__group-row__col">
                                <input id="name" name="Name" type="text" value="@Model.Name" />
                            </div>
                        </div>
                    </div>

                    <div class="form-additem__group">
                        <div class="form-additem__group-row">
                            <div class="form-additem__group-row__col">
                                <label for="type" class="">Тип объявления:</label>
                            </div>
                            <div class="form-additem__group-row__col">
                                <span><input type="radio" name="type" id="donor-type" value="donor" @(Model.Type == OfferTypeEnum.Donor ? "checked" : "") /> Донор</span>
                                <span><input type="radio" name="type" id="recipient-type" value="recipient" @(Model.Type == OfferTypeEnum.Recipient ? "checked" : "") /> Реципиент</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-additem__group">
                        <label for="category" class="">Категория крови:</label>
                        <select id="category" name="category">
                            <option disabled>Выберите группу крови</option>
                            <option value="1" @((int)Model.Category == 1 ? "selected" : "")>O(I) Rh−</option>
                            <option value="2" @((int)Model.Category == 2 ? "selected" : "")>O(I) Rh+</option>
                            <option value="3" @((int)Model.Category == 3 ? "selected" : "")>A(II) Rh−</option>
                            <option value="4" @((int)Model.Category == 4 ? "selected" : "")>A(II) Rh+</option>
                            <option value="5" @((int)Model.Category == 5 ? "selected" : "")>B(III) Rh−</option>
                            <option value="6" @((int)Model.Category == 6 ? "selected" : "")>B(III) Rh+</option>
                            <option value="7" @((int)Model.Category == 7 ? "selected" : "")>AB(IV) Rh−</option>
                            <option value="8" @((int)Model.Category == 8 ? "selected" : "")>AB(IV) Rh+</option>
                        </select>
                    </div>

                    <div class="form-additem__group">
                        <label for="DateOfBirth" class="">Дата рождения:</label>
                        <input id="DateOfBirth" name="DateOfBirth" type="date" value="@Model.DateOfBirth.ToShortDateString()" />
                    </div>

                    <div class="form-additem__group">
                        <label for="Weight" class="">Вес:</label>
                        <input id="Weight" name="Weight" type="text" value="@Model.Weight" />
                    </div>

                    <div class="form-additem__group">
                        <label for="Description" class="">Описание:</label>
                        <textarea name="Description">@Model.Description</textarea>
                    </div>

                    <div class="form-additem__group">
                        <label for="Phone" class="">Телефон:</label>
                        <input id="Phone" name="Phone" type="text" value="@Model.Phone" />
                    </div>

                    <div class="form-additem__group">
                        <label for="Email" class="">E-mail:</label>
                        <input id="Email" name="Email" type="text" value="@Model.Email" />
                    </div>

                    <div class="form-additem__group">
                        <label for="Address" class="">Район:</label>
                        <select id="address" name="Address">
                            <option selected disabled>Выберите регион</option>
                            <option value="53000056">Адыгея</option>
                            <option value="53000015">Алтайский край</option>
                            <option value="53000016">Амурская область</option>
                            <option value="53000017">Архангельская область</option>
                            <option value="53000018">Астраханская область</option>
                            <option value="53000058">Башкортостан</option>
                            <option value="53000019">Белгородская область</option>
                            <option value="53000020">Брянская область</option>
                            <option value="53000059">Бурятия</option>
                            <option value="53000021">Владимирская область</option>
                            <option value="53000022">Волгоградская область</option>
                            <option value="53000023">Вологодская область</option>
                            <option value="53000024">Воронежская область</option>
                            <option value="53000060">Дагестан</option>
                            <option value="53000025">Еврейская автономная область</option>
                            <option value="53000026">Забайкальский край</option>
                            <option value="53000027">Ивановская область</option>
                            <option value="53000061">Ингушетия</option>
                            <option value="53000028">Иркутская область</option>
                            <option value="53000029">Кабардино-Балкария</option>
                            <option value="53000030">Калининградская область</option>
                            <option value="53000062">Калмыкия</option>
                            <option value="53000031">Калужская область</option>
                            <option value="53000032">Камчатский край</option>
                            <option value="53000033">Карачаево-Черкесия</option>
                            <option value="53000034">Кемеровская область</option>
                            <option value="53000035">Кировская область</option>
                            <option value="53000036">Костромская область</option>
                            <option value="53000037">Краснодарский край</option>
                            <option value="53000038">Красноярский край</option>
                            <option value="53000039">Курганская область</option>
                            <option value="53000040">Курская область</option>
                            <option value="53000041">Ленинградская область</option>
                            <option value="53000042">Липецкая область</option>
                            <option value="53000043">Магаданская область</option>
                            <option value="53000065">Марий Эл</option>
                            <option value="53000066">Мордовия</option>
                            <option value="53000094">Москва</option>
                            <option value="53000044">Московская область</option>
                            <option value="53000045">Мурманская область</option>
                            <option value="53000119">Ненецкий автономный округ</option>
                            <option value="53000046">Нижегородская область</option>
                            <option value="53000047">Новгородская область</option>
                            <option value="53000048">Новосибирская область</option>
                            <option value="53000049">Омская область</option>
                            <option value="53000050">Оренбургская область</option>
                            <option value="53000051">Орловская область</option>
                            <option value="53000052">Пензенская область</option>
                            <option value="53000053">Пермский край</option>
                            <option value="53000054">Приморский край</option>
                            <option value="53000055">Псковская область</option>
                            <option value="53000057">Республика Алтай</option>
                            <option value="53000063">Республика Карелия</option>
                            <option value="53000064">Республика Коми</option>
                            <option value="1444278541">Республика Крым</option>
                            <option value="53000072">Ростовская область</option>
                            <option value="53000073">Рязанская область</option>
                            <option value="53000074">Самарская область</option>
                            <option value="53152804">Санкт-Петербург</option>
                            <option value="53000075">Саратовская область</option>
                            <option value="53000076">Сахалинская область</option>
                            <option value="53000077">Свердловская область</option>
                            <option value="1443782437">Севастополь</option>
                            <option value="53000068">Северная Осетия</option>
                            <option value="53000078">Смоленская область</option>
                            <option value="53000079">Ставропольский край</option>
                            <option value="53000080">Тамбовская область</option>
                            <option value="53000069">Татарстан</option>
                            <option value="53000081">Тверская область</option>
                            <option value="53000082">Томская область</option>
                            <option value="53000083">Тульская область</option>
                            <option value="53000070">Тыва</option>
                            <option value="53000084">Тюменская область</option>
                            <option value="53000085">Удмуртия</option>
                            <option value="53000086">Ульяновская область</option>
                            <option value="53000087">Хабаровский край</option>
                            <option value="53000071">Хакасия</option>
                            <option value="53000120">Ханты-Мансийский автономный округ</option>
                            <option value="53000088">Челябинская область</option>
                            <option value="53000089">Чечня</option>
                            <option value="53000090">Чувашия</option>
                            <option value="53000091">Чукотский автономный округ</option>
                            <option value="53000067">Якутия</option>
                            <option value="53000121">Ямало-Ненецкий автономный округ</option>
                            <option value="53000092">Ярославская область</option>
                        </select>
                    </div>

                    <input type="submit" value="Создать объявление" />
                </form>
            </div>
        </div>
    </main>

    @Html.Partial("_Footer")

    <script type="text/javascript">
        $(function () {
            $('#add-item-form').submit(function (event) {

                var data = {
                    Name: $("input[name='Name']").val(),
                    Type: $("#donor-type").attr("checked") ? 'donor' : 'recipient',
                    Category: $("#category").val(),
                    DateOfBirth: $("input[name='DateOfBirth']").val(),
                    Weight: $("input[name='Weight']").val(),
                    Description: $("textarea[name='Description']").val(),
                    Phone: $("input[name='Phone']").val(),
                    Email: $("input[name='Email']").val(),
                    GeoAddress: {
                        Id: 0,
                        Address: '',
                        Point: {
                            Lat: 0,
                            Lng: 0
                        }
                    }
                }

                var region = $('#address :selected').text();
                var myGeocoder = ymaps.geocode(region);
                myGeocoder.then(
                    function (res) {
                        var geoObject = res.geoObjects.get(0);
                        var coordinates = geoObject.geometry.getCoordinates();
                        data.GeoAddress.Id = geoObject.properties.get('metaDataProperty').GeocoderMetaData.id;
                        data.GeoAddress.Address = geoObject.properties.get('metaDataProperty').GeocoderMetaData.text;
                        data.GeoAddress.Point.Lat = coordinates[0];
                        data.GeoAddress.Point.Lng = coordinates[1];

                        $.post('/api/add-item/save/', data, function (res) {
                            if (res.success) {
                                alert('Объявление успешно добавлено!')
                                location.href = '/';
                            }
                            else if (res['err-messages']) {
                                alert('Ошибка');
                            }
                        });

                    },
                    function (err) {
                        alert('Ошибка');
                    }
                );

                event.preventDefault();
            });
        });
    </script>

</body>
</html>
